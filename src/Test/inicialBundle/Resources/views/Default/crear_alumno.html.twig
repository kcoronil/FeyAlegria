{% extends '::plantilla.html.twig' %}
{# bootstrap_3_layout.html.twig #}
{% if form is defined %}
    {% form_theme form "::formulario_bootstrap_div.html.twig" %}
{% endif %}

{% macro widget_prototype(widget, remove_text) %}
    {% if widget.vars.prototype is defined %}
        {% set form = widget.vars.prototype %}
        {% set name = widget.vars.prototype.vars.name %}
    {% else %}
        {% set form = widget %}
        {% set name = widget.vars.full_name %}
    {% endif %}

    <div data-content="{{ name }}">
        <div class="col-sm-12 ">
            <div class="row">
                <div class="col-sm-8 col-sm-offset-2 text-center">
                    <h3>Nuevo Representante</h3>
                </div>
                <div class="col-sm-1 text-left">
                    <a class="btn-remove btn btn-danger btn-xs" data-related="{{ name }}">{{ remove_text }}</a>
                </div>
            </div>
            <div class="row">
                    {{ form_row(form.tipoUsuario) }}
                    {{ form_row(form.principal) }}
                    {{ form_row(form.cedula) }}
                    {{ form_row(form.apellidos) }}
                    {{ form_row(form.nombres) }}
                    {{ form_row(form.fechaNacimiento) }}
                    {{ form_row(form.direccion) }}
                    {{ form_row(form.sexo) }}
                </div>
            </div>
        </div>
    </div>
{% endmacro %}

{% block extra_head %}

    <script type="text/javascript">
        $(document).ready(function() {
            $('.btn-add').click(function(event) {
                var collectionHolder = $('#' + $(this).attr('data-target'));
                var prototype = collectionHolder.attr('data-prototype');
                var form = prototype.replace(/__name__/g, collectionHolder.children().length);

                collectionHolder.append(form);
                $('.datepick').not('.hasDatePicker').children().datepicker({
                    format: "yyyy/mm/dd",
                    language:"es"
                });
                $('.datepick').on('change', function(){
                    $('.datepicker').hide();
                });
                $(document).on('click','.btn-remove', function(event) {
                    var name = $(this).attr('data-related');
                    $('*[data-content="'+name+'"]').remove();
                    var renombrar = renombrarForms();
                    var length = collectionHolder.children().length;

                    // alert(collectionHolder.children().eq(0).find(':input').length);
                    alert('formularios ' + length);
                    if (length) {
                        var indexes = [];

                        for (var i = 1; i <= length; i++) {
                            var divs_forms = collectionHolder.children().eq(i - 1).find(':input').length;
                            alert('form ' + i + ' Inputs ' + divs_forms);
                            /*if (divs_forms) {
                             for (var x = 1; x <= divs_forms; x++) {
                             var inputName = collectionHolder.children().eq(i - 1).find(':input').eq(x - 1).attr('name');
                             var inputNameArr = inputName.split("][");
                             //console.log(inputNameArr);
                             // inputNameArr = ["appbundle_form_name[parent_field", "index", "collection_field]"]
                             //it's the second (1) value in array
                             //var inputIndex = inputNameArr[1];
                             //indexes.push(inputIndex);
                             alert('inputName ' + inputName);
                             }
                             }*/
                        }
                        //find the highest value and add 1 for next field
                        //var highestIndex = Math.max.apply(null, indexes) + 1;
                        //return Math.max(highestIndex);
                    }
                });
            });



        });

        function renombrarForms() {

        }
    </script>


{% endblock %}
{% block enlace_atajo %}
    <li><a href="{{ path('inicial_lista_alumno') }}">Consultar Estudiantes</a></li>
{% endblock %}
{% block content %}
    <div class="row text-center">
        {% if form is defined %}
            <div class="col-sm-12 text-left">
                <div class="col-sm-12">
                    {{ form_start(form) }}
                        {{ form_row(form.cedula) }}
                        {{ form_row(form.cedulaEstudiantil) }}
                        {{ form_row(form.apellidos) }}
                        {{ form_row(form.nombres) }}
                        {{ form_row(form.fechaNacimiento) }}
                        {{ form_row(form.lugarNacimiento) }}
                        {{ form_row(form.sexo) }}
                    <div id="post_usuario" class="col-sm-12" data-prototype="{{ _self.widget_prototype(form.usuario, 'eliminar representante')|escape }}">
                        {% for widget in form.usuario.children %}
                            {{ _self.widget_prototype(widget, 'eliminar representante') }}
                        {% endfor %}
                    </div>
                    <div class="col-sm-12 text-center ">
                        <br>
                        <a class="btn-add btn btn-default" data-target="post_usuario">Agregar representante</a>
                    </div>
                    <div class="col-sm-12 text-center ">
                        <br>
                        {{ form_row(form.guardar) }}
                        {{ form_row(form.guardar_crear) }}
                        {{ form_end(form) }}
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}